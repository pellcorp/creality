[gcode_macro BED_MESH_CALIBRATE]
rename_existing: _BED_MESH_CALIBRATE
gcode:
    {% if printer["gcode_macro _SAF_BED_MESH_START"] != null %}
    _SAF_BED_MESH_START
    {% endif %}

    _BED_MESH_CALIBRATE {rawparams}

    {% if printer["gcode_macro _SAF_BED_MESH_END"] != null %}
    _SAF_BED_MESH_END
    {% endif %}


[gcode_macro PROBE_CALIBRATE]
rename_existing: _PROBE_CALIBRATE
gcode:
    {% if "xy" in printer.toolhead.homed_axes %}
        {% set max_z = printer.toolhead.axis_maximum.z - 5 %}
        SET_KINEMATIC_POSITION Z={max_z}
    {% endif %}
    _PROBE_CALIBRATE {rawparams}
